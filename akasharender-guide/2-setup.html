<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>Project Setup</title>
<meta name="pagename" content="AkashaRender">
<meta name="date" content="Thu May 12 2016 18:18:19 GMT-0700 (PDT)">
<meta name="DC.title" content="AkashaRender">
<meta name="og:title" content="AkashaRender">
<meta name="og:url" content="2-setup.html.md">
<link rel="sitemap" type="application/xml" title="Sitemap" href="sitemap.xml">
<link rel="canonical" href="2-setup.html.md">
<meta name="viewport" content="width=device-width">
<link rel="stylesheet" href="/vendor/columnal/columnal.css" type="text/css" media="screen">
<!--[if lt IE 9]>
    	<link rel="stylesheet" href="/vendor/columnal/ie.css" type="text/css" media="screen" />
	<![endif]-->
<!--[if lte IE 7]>
		<link rel="stylesheet" href="/vendor/columnal/fixed-984px-ie.css" type="text/css" media="screen" />
	<![endif]-->
<!--[if lte IE 6]>
		<link rel="stylesheet" href="/vendor/columnal/ie6-984px.css" type="text/css" media="screen" />
	<![endif]-->
<link rel="stylesheet" href="/vendor/columnal/custom.css" type="text/css" media="screen">
<link rel="stylesheet" href="/video.css" type="text/css" media="screen">
<link rel="stylesheet" href="/vendor/columnal/build.css" type="text/css" media="screen">
<link rel="stylesheet" href="/style.css" type="text/css" media="screen">
<script type="text/javascript">var switchTo5x=true;</script>
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "c828d855-27af-4910-b7a5-2b9b14030895"});</script>
<div id="fb-root"></div>
<script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=234745903279111";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@akashacms">
<meta name="twitter:creator" content="@7genblogger">
<meta name="twitter:url" content="2-setup.html.md">
<meta name="twitter:title" content="Project Setup">
<meta name="twitter:image" content="http://akashacms.com/logo.gif">
</head>
<body>
<!--[if lt IE 7]><p class=chromeframe>Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p><![endif]-->
<p>An AkashaRender project directory has these attributes:</p>
<ul>
<li><em>package.json</em> This file lists dependencies on Node.js packages used to build the project, and the <em>scripts</em> section can contain commands to drive the process.</li>
<li>Several input directories to hold project assets, content files, layout templates, and partials (smaller templates).</li>
<li>A Node.js script (or more than one) to drive the rendering process.</li>
<li>(Optionally) Another Node.js script containing DOM processing functions for use with the Mahabhuta engine.</li>
</ul>
<p>Start by making a project directory:</p>
<pre><code>$ mkdir myproject
$ cd myproject
$ npm init
... answer all the questions asked by npm init

Is this ok? (yes) yes
</code></pre>
<p>Then install AkashaRender and globfs.</p>
<pre><code>$ npm install globfs@stable akasharender@stable --save
</code></pre>
<p>NOTE: At the moment AkashaRender is not in npm, so instead you&apos;ll have to add this to the dependencies section in <code>package.json</code></p>
<pre><code>  &quot;dependencies&quot;: {
    &quot;akasharender&quot;: &quot;akashacms/akasharender&quot;,
    &quot;globfs&quot;: &quot;^0.1.2&quot;
  }
</code></pre>
<p>If this project is to generate an EPUB3, then you must also install epubtools:</p>
<pre><code>$ npm install epubtools@stable --save
</code></pre>
<p>Next, make some directories:</p>
<pre><code>$ mkdir assets documents layouts partials
</code></pre>
<p>Make an empty CSS file (or fill it with CSS of your desire)</p>
<pre><code>$ mkdir assets/style
$ touch assets/style/main.css
</code></pre>
<p>Create a simple layout template as <code>layouts/page.html.ejs</code> containing</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;utf-8&quot; /&gt;
&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge,chrome=1&quot; /&gt;
&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;/&gt;
&lt;title&gt;&lt;%= title %&gt;&lt;/title&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;/style/main.css&quot;
      type=&quot;text/css&quot; media=&quot;screen&quot;/&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;%- content %&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>This demonstrates two types of content inclusion. With <code>&lt;%= title %&gt;</code> we are inserting a metadata value with interpolation such that any HTML tags get encoded. However with <code>&lt;%- content %&gt;</code> the metadata value is not encoded, so that any HTML tags are copied verbatim.</p>
<p>The <code>content</code> variable is special in that it is the result of rendering. All other values we might include come from the frontmatter.</p>
<p>Now let&apos;s create a simple content document, as <code>documents/index.html.md</code>.</p>
<pre><code>---
layout: page.html.ejs
title: Four Score and Seven Years Ago
---

Four score and seven years ago our fathers brought forth on this continent a new nation conceived in liberty and dedicated to the proposition that all men are created equal.
</code></pre>
<p>The frontmatter appears between the --- lines. It is formatted with YAML, a fairly simple markup system to represent data objects as simple text. The best documentation I know of for YAML is on the Wikipedia: <a href="https://en.wikipedia.org/wiki/YAML">https://en.wikipedia.org/wiki/YAML</a></p>
<p>The way to interpret the file name is to think of multiple extensions that describe the conversion process and the final output format. In this case the file is written in Markdown, and produces HTML.</p>
<p>The next thing to do is the Node.js script to drive the rendering process. Create <code>render.js</code> containing</p>
<pre><code>&apos;use strict&apos;;

const render = require(&apos;akasharender&apos;);

render.render({
    documentDirs: [ &apos;documents&apos; ],
    layoutDirs: [ &apos;layouts&apos; ],
    partialDirs: [ &apos;partials&apos; ],
    mahafuncs: [  ],
    renderTo: &apos;out&apos;
})
.then(results =&gt; {
    for (var i = 0; i &lt;  results.length; i++) {
        var result = results[i];
        if (result.error) {
            console.error(`RENDER ERROR ${result.fullpath} ==&gt; ${result.error} ${result.error.stack}`);
        } else {
            console.log(result.result);
        }
    }
})
.catch(err =&gt; console.error(err.stack));
</code></pre>
<p>The object passed into <code>render.render</code> is the configuration for this project. It names the input directories and the directory into which the project should be rendered (<code>renderTo</code>).</p>
<p>You could leave off the last part if you like, but it&apos;s useful to print out the results when the script is done as confirmation of what was done.</p>
<p>The last thing is to set up the scripts section of the package.json with tasks used in building the project:</p>
<pre><code>&quot;scripts&quot;: {
  &quot;clean&quot;: &quot;rm -rf out&quot;,
  &quot;prebuild&quot;: &quot;mkdir -p out &amp;&amp; globfs copy assets out &amp;&amp; globfs copy documents out &apos;**/*.html&apos;&quot;,
  &quot;build&quot;: &quot;node ./render&quot;
},
</code></pre>
<p>Then you simply run</p>
<pre><code>$ npm run clean
$ npm run build
</code></pre>
<p>And the project is built for you.</p>
<script src="http//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/vendor/jquery.js"><\/script>')</script>
<script src="/vendor/log.js"></script>
<script src="/vendor/modernizr.js"></script>
<script src="/script.js"></script>
<script type="text/javascript">
var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-37003917-1']);
  _gaq.push(['_setDomainName', 'akashacms.com']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>