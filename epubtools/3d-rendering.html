<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!-- Consider adding a manifest.appcache: h5bp.com/d/Offline -->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width">


    <title>The AkashaCMS rendering process</title>





 
 
 
 













<meta name="pagename" content="The AkashaCMS rendering process">









<meta name="date" content="Sat Oct 26 1985 01:15:00 GMT-0700 (Pacific Daylight Time)">

<meta name="DC.title" content="The AkashaCMS rendering process">














<!-- OpenGraph Meta Tags -->

<meta name="og:title" content="The AkashaCMS rendering process">

<meta name="og:url" content="https://akashacms.com/epubtools/3d-rendering.html">


































<link rel="canonical" href="https://akashacms.com/epubtools/3d-rendering.html">

<link rel="sitemap" type="application/xml" title="Sitemap" href="../sitemap.xml">


<link rel="stylesheet" type="text/css" href="../akasha/epub-website/style.css"><link rel="stylesheet" type="text/css" href="../vendor/bootstrap/css/bootstrap.min.css"><link rel="stylesheet" type="text/css" href="../pulse.min.css"><link rel="stylesheet" type="text/css" href="../style.css"><link rel="stylesheet" type="text/css" href="../vendor/fontawesome-free/css/all.min.css"><link rel="stylesheet" type="text/css" href="../vendor/highlight.js/styles/tomorrow-night-blue.css">


<style>
#container { padding-top: 5px; }
</style>
</head>
<body class="ebook-page">

    <nav class="navbar navbar-expand-lg navbar-dark fixed-top bg-dark d-print-none">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ebookNavbarContent" aria-controls="ebookNavbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="ebookNavbarContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="ebookNavbarAkashaCMSdropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    AkashaCMS
                    </a>
                    <div class="dropdown-menu" aria-labelledby="ebookNavbarAkashaCMSdropdown">
                        <a class="dropdown-item" href="../index.html">Home</a>
                        <a class="dropdown-item" href="../akasharender/toc.html">AkashaRender</a>
                        <a class="dropdown-item" href="../plugins/index.html">Plugins</a>
                        <a class="dropdown-item" href="../mahabhuta/toc.html">Mahabhuta</a>
                        <a class="dropdown-item" href="toc.html">EPUB Tools</a>
                        <a class="dropdown-item" href="../howto/index.html">How To</a>
                        <a class="dropdown-item" href="../news/index.html">News</a>
                        <a class="dropdown-item" href="../about.html">About</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="ebookNavbarToCdropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Table of Contents
                    </a>
                    <ol type="1" start="1" class="dropdown-menu" aria-labelledby="ebookNavbarToCdropdown">
        <li class="dropdown-item"><a id="introduction" href="1-introduction.html" title="Introduction to AkashaEPUB">Introduction to AkashaEPUB</a></li>
        <li class="dropdown-item"><a id="installation" href="2-installation.html" title="Installing the AkashaEPUB toolchain">Installing the AkashaEPUB toolchain</a></li>
        <li class="dropdown-item"><a id="creating-content" href="3-creating-content.html" title="Creating book content">Creating book content</a>
            <ol>
                <li><a id="chap-3c-content-markup" href="3c-content-markup.html" title="Content markup formats">Content markup formats</a></li>
                <li><a id="chap-3d-rendering" href="3d-rendering.html" title="The AkashaCMS rendering process">The AkashaCMS rendering process</a></li>
                <li><a id="chap-3da-css" href="3da-css.html" title="CSS, Fonts, and Stylesheets for creating good quality EPUB&apos;s">CSS, Fonts, and Stylesheets for creating good quality EPUB&apos;s</a></li>
                <li><a id="chap-3e-html5-structure" href="3e-html5-structure.html" title="Summary of HTML5 markup in AkashaEPUB Documents">Summary of HTML5 markup in AkashaEPUB Documents</a></li>
                <li><a id="chap-3e-internal-links" href="3e-internal-links.html" title="LINK, IMG tags and the requirement for relative URL&apos;s">LINK, IMG tags and the requirement for relative URL&apos;s</a></li>
            </ol>
        </li>
        <li class="dropdown-item"><a id="configuration" href="4-configuration.html" title="Configuration files for AkashaEPUB projects">Configuration files for AkashaEPUB projects</a>
            <ol>
                <li><a id="chap-4a-akasharender-epub" href="4a-akasharender-epub.html" title="Cleaning up non-EPUB constructs with the `akasharender-epub` plugin">Cleaning up non-EPUB constructs with the `akasharender-epub` plugin</a></li>
            </ol>
        </li>
        <li class="dropdown-item"><a id="structure" href="5-structure.html" title="Structuring your book">Structuring your book</a></li>
        <li class="dropdown-item"><a id="building-EPUB" href="6-building-EPUB.html" title="Building an EPUB with AkashaEPUB">Building an EPUB with AkashaEPUB</a>
            <ol>
                <li><a id="chap-6aa-epub-website" href="6aa-epub-website.html" title="Detailed walk-through an embedding EPUB content in an AkashaCMS website">Detailed walk-through an embedding EPUB content in an AkashaCMS website</a></li>
                <li><a id="chap-6b-validation" href="6b-validation.html" title="Validating EPUB files built by AkashaEPUB">Validating EPUB files built by AkashaEPUB</a></li>
            </ol>
        </li>
        <li class="dropdown-item"><a id="akashacms-project" href="7-akashacms-project.html" title="The AkashaCMS Open Source Project">The AkashaCMS Open Source Project</a></li>
        <li class="dropdown-item"><a id="about" href="8-about.html" title="About the author, David Herron">About the author, David Herron</a></li>
        <li class="dropdown-item"><a id="references" href="9-references.html" title="References">References</a></li>
        <li class="dropdown-item"><a id="copyright" href="0a-copyright.html" title="Copyright Notice">Copyright Notice</a></li>
    </ol>
                </li>
                <form class="form-inline" action="//www.google.com" id="cse-search-box">
                    <div>
                    <input type="hidden" name="cx" value="partner-pub-2401070691062219:4564101022">
                    <input type="hidden" name="ie" value="UTF-8">
                    <input type="text" name="q" size="30">
                    <input type="submit" name="sa" value="Search">
                    </div>
                </form>
                <script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en">
                // Not empty
                </script>
            </ul>
        </div>
    </nav>

<div id="container" class="container">

    <header class="epub-website-ebook-masthead" id="ebook-masthead">
  <table border="0"><tr>
      
      <td class="epub-website-ebook-masthead-title">
          
      </td>
  </tr></table>
</header>

    <div class="panel panel-default">
        <div class="panel-heading epub-website-ebook-navigation-header" id="ebook-navigation">



<div class="epub-website-ebook-chapter-area">
<a href="3c-content-markup.html">
    <span class="fas fa-chevron-left" aria-hidden="true" style></span>
    <span class="fas fa-chevron-left" aria-hidden="true" style></span>
    <span class="fas fa-chevron-left" aria-hidden="true" style></span>
    <span class="fas fa-chevron-left" aria-hidden="true" style></span>
</a>

<h1 class="panel-title" align="center" style>The AkashaCMS rendering process</h1>

<a href="3da-css.html">
    <span class="fas fa-chevron-right" aria-hidden="true" style="display: inline"></span>
    <span class="fas fa-chevron-right" aria-hidden="true" style="display: inline"></span>
    <span class="fas fa-chevron-right" aria-hidden="true" style="display: inline"></span>
    <span class="fas fa-chevron-right" aria-hidden="true" style="display: inline"></span>
</a>
</div>

</div>

        <div id="book-page-content" class="panel-body">
            
            <div id="book-page-content" class="panel-body"><p>This is what we&apos;ve been working towards for a few sections - rendering HTML files from any content file.  The EPUB3 specification uses the XHTML variant of HTML5 and CSS for the rendered content.  That&apos;s our goal at the moment, to take a Markdown file and turn it into XHTML5 suitable for display on an EPUB reader.  At the end of this section we&apos;ll we&apos;ll know how to do this.  Promise.</p>
<p>The AkashaCMS website does have complete documentation about layouts and page rendering at - 
                    <img class="akashacms-external-links-favicon opengraph-no-promote" src="https://www.google.com/s2/favicons?domain=akashacms.com" style="display: inline-block; padding-right: 2px;" alt="(akashacms.com)">
                    <a href="https://akashacms.com/akasharender/layouts-partials.html" rel="nofollow" target="_blank">https://akashacms.com/akasharender/layouts-partials.html</a></p>
<p>AkashaRender renders the content to HTML, then encapsulates that HTML within a layout template file declared in the <code>layout</code> tag in the document.  That is, a four-stage process is followed:</p>
<ol>
<li>The content file is rendered, producing an HTML output.</li>
<li>Custom tags and other DOM processing are performed by Mahabhuta.</li>
<li>Assuming the content declares a <code>layout</code> template, the HTML from stage 1 is rendered into the corresponding template.</li>
<li>Custom tags and other DOM processing is again performed by Mahabhuta.</li>
</ol>
<p>This guide is formatted using the <code>ebook-page.html.ejs</code> layout template (see: 
                    <img class="akashacms-external-links-favicon opengraph-no-promote" src="https://www.google.com/s2/favicons?domain=github.com" style="display: inline-block; padding-right: 2px;" alt="(github.com)">
                    <a href="https://github.com/akashacms/epub-guide/blob/master/layouts/ebook-page.html.ejs" rel="nofollow" target="_blank">https://github.com/akashacms/epub-guide/blob/master/layouts/ebook-page.html.ejs</a>).  Therefore, each page in the guide has at least this much metadata:</p>
<pre><code class="hljs"><span class="hljs-meta">---</span>
<span class="hljs-attr">layout:</span> <span class="hljs-string">ebook-page.html.ejs</span>
<span class="hljs-attr">title:</span>  <span class="hljs-string">Whatever</span> <span class="hljs-string">the</span> <span class="hljs-string">Title</span> <span class="hljs-string">is</span>
<span class="hljs-meta">---</span>
</code></pre>
<p>That template is currently:</p>
<pre><code class="hljs"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="hljs-attr">xmlns:epub</span>=<span class="hljs-string">&quot;http://www.idpf.org/2007/ops&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">title</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ak-stylesheets</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ak-stylesheets</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ak-headerJavaScript</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ak-headerJavaScript</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">section</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">title</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">article</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%-</span> <span class="hljs-attr">content</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">article</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">footer</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin-top: 5em;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">hr</span>/&gt;</span>Copyright &#xA9; 2015 by David Herron, Creative Commons, CC BY-ND, see <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;0a-copyright.html&quot;</span>&gt;</span>copyright page<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> for details <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ak-footerJavaScript</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ak-footerJavaScript</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>This allows for a page title, page content inside an <code>&lt;article&gt;</code> tag, a <code>&lt;footer&gt;</code>, and space for CSS and JavaScript files.  While EPUB readers have traditionally been very limited devices, EPUB3 allows for limited use of the full HTML5, CSS3 and JavaScript paradigm used in modern web browsers.</p>
<h1>Brief overview of EJS templates</h1>
<p>The <code>content</code> variable is autogenerated by AkashaRender and contains the rendered content.  This segment of the code inserts the rendering without any encoding:</p>
<pre><code class="hljs">&lt;%- content %&gt;
</code></pre>
<p>By using the <code>&lt;%- %&gt;</code> sequence, the HTML in the <code>content</code> variable is inserted as HTML.  The HTML is simply copied to the output file as-is with no interpretation.</p>
<p>The <code>&lt;header&gt;&lt;h1&gt;&lt;%= title %&gt;&lt;/h1&gt;&lt;/header&gt;</code> sequence instead encodes <code>title</code> to safe HTML values.</p>
<p>This is bog-standard EJS behavior, and your templates use one or the other form depending on the circumstances.</p>
<p>EJS also lets you write code inside the template.  What if the <code>title</code> variable was left out of a content file?  The processing would crash at that point, and maybe your book doesn&apos;t require a section header at the beginning of each section.  Consider:</p>
<pre><code class="hljs"><span class="hljs-section">&lt;% if (title) { %&gt;</span>
<span class="hljs-section">&lt;header&gt;</span><span class="hljs-section">&lt;h1&gt;</span><span class="hljs-section">&lt;%= title %&gt;</span><span class="hljs-section">&lt;/h1&gt;</span><span class="hljs-section">&lt;/header&gt;</span>
<span class="hljs-section">&lt;% } %&gt;</span>
</code></pre>
<p>This says if the <code>title</code> variable is present, then render the <code>header</code> and <code>h1</code> tags shown here, but don&apos;t do so if there&apos;s no <code>title</code>.</p>
<h2>Using data in a fancier template</h2>
<p>As an example of more comprehensive metadata usage, consider a series of pages containing information tables.  The table data could be given as metadata.   The layout template could format that data into an HTML table, and encapsulate it into a complete HTML file.</p>
<p>Suppose you were writing a book of ice cream sundae recipes.  The metadata could list the ingredients, while the content could describe how to assemble the Sundae and perhaps author remniscences (and pictures) from childhood visits to Atlantic City.</p>
<p>Consider - <code>banana-split.html.md</code></p>
<pre><code class="hljs"><span class="hljs-meta">---</span>
<span class="hljs-attr">layout:</span> <span class="hljs-string">ice-cream-sundae.html.ejs</span>
<span class="hljs-attr">title:</span> <span class="hljs-string">Banana</span> <span class="hljs-string">Split</span> <span class="hljs-string">Sundae</span>
<span class="hljs-attr">dishStyle:</span> <span class="hljs-string">Tray</span>
<span class="hljs-attr">base:</span> <span class="hljs-number">1</span> <span class="hljs-string">Banana,</span> <span class="hljs-string">cut</span> <span class="hljs-string">in</span> <span class="hljs-string">half</span> <span class="hljs-string">lengthwise</span>
<span class="hljs-attr">flavors:</span> <span class="hljs-string">Vanilla</span>
<span class="hljs-attr">topping:</span> <span class="hljs-string">Chocolate</span> <span class="hljs-string">Syrup</span>
<span class="hljs-attr">sprinkles:</span> <span class="hljs-string">Peanuts</span>
<span class="hljs-attr">image:</span> <span class="hljs-string">images/sundaes/banana-split.png</span>
<span class="hljs-meta">---</span>

<span class="hljs-string">In</span> <span class="hljs-string">the</span> <span class="hljs-string">summer</span> <span class="hljs-string">of</span> <span class="hljs-number">1967</span> <span class="hljs-string">I</span> <span class="hljs-string">had</span> <span class="hljs-string">my</span> <span class="hljs-string">first</span>
<span class="hljs-string">REAL</span> <span class="hljs-string">banana</span> <span class="hljs-string">split</span> <span class="hljs-string">sundae,</span> <span class="hljs-string">and</span> <span class="hljs-string">I</span> <span class="hljs-string">thought</span>
<span class="hljs-string">I&apos;d</span> <span class="hljs-string">gone</span> <span class="hljs-string">to</span> <span class="hljs-string">heaven</span> <span class="hljs-string">it</span> <span class="hljs-string">was</span> <span class="hljs-string">so</span> <span class="hljs-string">good.</span>
<span class="hljs-string">These</span> <span class="hljs-string">are</span> <span class="hljs-string">easy</span> <span class="hljs-string">to</span> <span class="hljs-string">make</span> <span class="hljs-string">and</span>
<span class="hljs-string">sure</span> <span class="hljs-string">to</span> <span class="hljs-string">be</span> <span class="hljs-string">a</span> <span class="hljs-string">crowd</span> <span class="hljs-string">pleaser.</span>
<span class="hljs-string">...</span>
</code></pre>
<p>Plausible template - <code>ice-cream-sundae.html.ejs</code></p>
<pre><code class="hljs"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="hljs-attr">xmlns:epub</span>=<span class="hljs-string">&quot;http://www.idpf.org/2007/ops&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">title</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ak-stylesheets</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ak-stylesheets</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ak-headerJavaScript</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ak-headerJavaScript</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">section</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">title</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">article</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;&lt;%- image %&gt;&quot;</span>/&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Dish style<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">dishStyle</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Base<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">base</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Ice Cream Flavor<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">flavors</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Topping<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">topping</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Sprinkles<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">sprinkles</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%-</span> <span class="hljs-attr">content</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">article</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">footer</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin-top: 5em;&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">hr</span>/&gt;</span>Copyright &#xA9; 2015 by David Herron, Creative Commons, CC BY-ND, see <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;0a-copyright.html&quot;</span>&gt;</span>copyright page<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> for details <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ak-footerJavaScript</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ak-footerJavaScript</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>This template would be used in an e-book (or website) with several Ice Cream Sundae recipes.  For each you describe the ingredients in the page metadata, and the template formats that metadata into a nice table.  The overall page structure is the same as the <code>page.html.ejs</code> template shown earlier.</p>
<h2>Mahabhuta</h2>
<p>Earlier we mentioned the Mahabhuta engine.  Full documentation is online at 
                    <img class="akashacms-external-links-favicon opengraph-no-promote" src="https://www.google.com/s2/favicons?domain=akashacms.com" style="display: inline-block; padding-right: 2px;" alt="(akashacms.com)">
                    <a href="https://akashacms.com/mahabhuta/toc.html" rel="nofollow" target="_blank">https://akashacms.com/mahabhuta/toc.html</a></p>
<p>Mahabhuta&apos;s purpose is to process HTML as a DOM using a jQuery-like API.  It lets you transfer some front-end-engineering knowledge into back-end document construction.  One of Mahabhuta&apos;s biggest purposes is custom tags one can invent for specific purposes.</p>
<p>We&apos;ve already seen an example in the page templates above:</p>
<pre><code class="hljs"><span class="hljs-section">&lt;ak-stylesheets&gt;</span><span class="hljs-section">&lt;/ak-stylesheets&gt;</span>
<span class="hljs-section">&lt;ak-headerJavaScript&gt;</span><span class="hljs-section">&lt;/ak-headerJavaScript&gt;</span>
</code></pre>
<p>These two custom tags generate <code>&lt;link&gt;</code> and <code>&lt;script&gt;</code> tags corresponding to the CSS and JavaScript files to be used by the rendered HTML.  With Mahabhuta a web or e-book developer can code up any kind of DOM manipulation to customize their rendered HTML.</p>
<p>The ice cream sundae example discussed earlier could be implemented a different way.  Like:</p>
<pre><code class="hljs">&lt;ice-cream-sundae <span class="hljs-attribute">dish-style</span>=<span class="hljs-string">&quot;Tray&quot;</span>
    <span class="hljs-attribute">base</span>=<span class="hljs-string">&quot;1 Banana, cut in half lengthwise&quot;</span>
    <span class="hljs-attribute">flavors</span>=<span class="hljs-string">&quot;Vanilla&quot;</span>
    <span class="hljs-attribute">topping</span>=<span class="hljs-string">&quot;Chocolate Syrup&quot;</span>
    <span class="hljs-attribute">sprinkles</span>=<span class="hljs-string">&quot;Peanuts&quot;</span>
    <span class="hljs-attribute">image</span>=<span class="hljs-string">&quot;images/sundaes/banana-split.png&quot;</span> /&gt;
</code></pre>
<p>Now that you&apos;ve got the custom tag, what do you do?</p>
<p>First step is creating a <em>Mahafunc</em>, or Mahabhuta Function.</p>
<pre><code class="hljs"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IceCreamSundaeElement</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">mahabhuta</span>.<span class="hljs-title">CustomElement</span> </span>{
    get elementName() { <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ice-cream-sundae&quot;</span>; }
    process($element, metadata, dirty, done) {
        <span class="hljs-keyword">return</span> akasha.partial(metadata.config, <span class="hljs-string">&quot;ice-cream-sundae.html.ejs&quot;</span>, {
            dishStyle: $element.attr(<span class="hljs-symbol">&apos;dish</span>-style&apos;),
            base: $element.attr(<span class="hljs-symbol">&apos;bas</span>e&apos;),
            flavors: $element.attr(<span class="hljs-symbol">&apos;flavor</span>s&apos;),
            topping: $element.attr(<span class="hljs-symbol">&apos;toppin</span>g&apos;),
            sprinkles: $element.attr(<span class="hljs-symbol">&apos;sprinkle</span>s&apos;)
        });
    }
}
module.exports.mahabhuta.addMahafunc(<span class="hljs-keyword">new</span> <span class="hljs-type">IceCreamSundaeElement</span>());
</code></pre>
<p>By the time this code is executed, the HTML content has been parsed down to a jQuery-esque DOM, the elements matching the selector string returned by <code>elementName</code> have been found, and this function receives one of those elements as <code>$element</code>.  The element will be erased and completely replaced by whatever HTML is returned from the function.</p>
<p>This relies on a different AkashaRender feature, the <em>Partial</em>.  Partials are little snippets of HTML, either straight HTML or an HTML template, that can be reused in multiple places.  We&apos;ve specified a Partial named <code>ice-cream-sundae.html.ejs</code> which could be:</p>
<pre><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Dish style<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">dishStyle</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Base<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">base</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Ice Cream Flavor<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">flavors</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Topping<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">topping</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>Sprinkles<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">%=</span> <span class="hljs-attr">sprinkles</span> %&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
</code></pre>
<p>The template variables in this case come from the anonymous object passed to <code>akasha.partial</code>.  The template is processed as an EJS template because of the file name.  If you follow the connections, the attributes passed in the tag above make their way through the CustomElement class to this template, where they&apos;re substituted into the HTML table, that&apos;s then passed back replacing the <code>&lt;ice-cream-sundae&gt;</code> element.</p>
<h2>A missed Partial opportunity</h2>
<p>The page templates above missed an opportunity to make the <code>&lt;footer&gt;</code> reusable in a Partial.  Instead of hard-coding the same <code>&lt;footer&gt;</code> tag in every template, the templates could all have:</p>
<pre><code class="hljs">&lt;partial <span class="hljs-built_in">file</span>-<span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;footer.html&quot;</span>/&gt;
</code></pre>
<p>The <code>&lt;partial&gt;</code> tag does what you expect, it evaluates the named partial and replacing itself with the resulting HTML.  The file named <code>footer.html</code> could contain this:</p>
<pre><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-name">footer</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin-top: 5em;&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hr</span>/&gt;</span>Copyright &#xA9; 2015 by David Herron, Creative Commons, CC BY-ND,
see <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;0a-copyright.html&quot;</span>&gt;</span>copyright page<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> for details
<span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>
</code></pre>
<p>You then have one file, <code>footer.html</code>, to edit any time you wish to edit the footer.</p>
</div>
            


            <div class="panel-heading epub-website-ebook-navigation-header" id="ebook-navigation-bottom">



<div class="epub-website-ebook-chapter-area">
<a href="3c-content-markup.html">
    <span class="fas fa-chevron-left" aria-hidden="true" style></span>
    <span class="fas fa-chevron-left" aria-hidden="true" style></span>
    <span class="fas fa-chevron-left" aria-hidden="true" style></span>
    <span class="fas fa-chevron-left" aria-hidden="true" style></span>
</a>

<h1 class="panel-title" align="center" style>The AkashaCMS rendering process</h1>

<a href="3da-css.html">
    <span class="fas fa-chevron-right" aria-hidden="true" style="display: inline"></span>
    <span class="fas fa-chevron-right" aria-hidden="true" style="display: inline"></span>
    <span class="fas fa-chevron-right" aria-hidden="true" style="display: inline"></span>
    <span class="fas fa-chevron-right" aria-hidden="true" style="display: inline"></span>
</a>
</div>

</div>

            <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'akashacms'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the 
                    <img class="akashacms-external-links-favicon opengraph-no-promote" src="https://www.google.com/s2/favicons?domain=disqus.com" style="display: inline-block; padding-right: 2px;" alt="(disqus.com)">
                    <a href="https://disqus.com/?ref_noscript" rel="nofollow" target="_blank">comments powered by Disqus.</a></noscript>

                    <img class="akashacms-external-links-favicon opengraph-no-promote" src="https://www.google.com/s2/favicons?domain=disqus.com" style="display: inline-block; padding-right: 2px;" alt="(disqus.com)">
                    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow" target="_blank">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
    </div>
    <footer id="footer-row" class="container">
    

<a rel="nofollow noskim" href="https://www.amazon.com/gp/product/1785881507/ref=as_li_ss_il?ie=UTF8&amp;fpl=fresh&amp;pf_rd_m=ATVPDKIKX0DER&amp;pf_rd_s=&amp;pf_rd_r=6C1SVA4RRTWPTY7VN1Z2&amp;pf_rd_t=36701&amp;pf_rd_p=14bf09e4-93c8-43ff-8639-e7979e7d1787&amp;pf_rd_i=desktop&amp;linkCode=li2&amp;tag=davidherron-20&amp;linkId=1a83c9a47355206fbe8622bf9e90b086" target="_blank"><img border="0" src="https://ws-na.amazon-adsystem.com/widgets/q?_encoding=UTF8&amp;ASIN=1785881507&amp;Format=_SL250_&amp;ID=AsinImage&amp;MarketPlace=US&amp;ServiceVersion=20070822&amp;WS=1&amp;tag=techsparx-20" width="175"></a>

<a rel="nofollow noskim" href="https://www.amazon.com/Asynchronous-Node-js-JavaScript-Promises-Generators-ebook/dp/B01N2Z4SOR/ref=as_li_ss_tl?ie=UTF8&amp;qid=1498526267&amp;sr=8-1&amp;keywords=asynchronous+javascript+promises+generators&amp;linkCode=ll1&amp;tag=techsparx-20&amp;linkId=0b8a5dc44c97bf8eb8452dac15ae724b" target="_blank"><img border="0" src="https://techsparx.com/nodejs/img/es-2015-16-17-promises-generators-and-async-await-2-1000.jpg" width="175"></a>

<a rel="nofollow noskim" href="https://www.amazon.com/Creating-eBooks-Markdown-Source-Tools-ebook/dp/B00WTKDH72/ref=as_li_ss_tl?_encoding=UTF8&amp;psc=1&amp;refRID=4SGHASEAZJKJBV0G60R0&amp;linkCode=ll1&amp;tag=techsparx-20&amp;linkId=941071a7b25f067767f82a7b11c06968" target="_blank"><img border="0" src="https://techsparx.com/nodejs/img/create-ebook-cover.jpg" width="175"></a>

    
<div class="fb-like-box" data-href="http://www.facebook.com/Akashacms" data-width="125" data-height="250" data-show-faces="false" data-stream="false" data-header="true"></div>

    </footer>
</div>

<script src="../vendor/jquery/jquery.min.js"></script><script src="../vendor/popper.js/umd/popper.min.js"></script><script src="../vendor/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-37003917-1']);
  _gaq.push(['_setDomainName', 'akashacms.com']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- partial file-name="piwik_analytics.html"></partial -->


</body>
</html>
