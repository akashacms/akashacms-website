<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!-- Consider adding a manifest.appcache: h5bp.com/d/Offline -->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width">


    <title>Processing HTML DOM with Mahabhuta&apos;s Mahafuncs</title>





 
 
 
 













<meta name="pagename" content="Processing HTML DOM with Mahabhuta&apos;s Mahafuncs">









<meta name="date" content="Sat Oct 26 1985 01:15:00 GMT-0700 (Pacific Daylight Time)">

<meta name="DC.title" content="Processing HTML DOM with Mahabhuta&apos;s Mahafuncs">














<!-- OpenGraph Meta Tags -->

<meta name="og:title" content="Processing HTML DOM with Mahabhuta" s mahafuncs'>

<meta name="og:url" content="https://akashacms.com/mahabhuta/processing.html">


































<link rel="canonical" href="https://akashacms.com/mahabhuta/processing.html">

<link rel="sitemap" type="application/xml" title="Sitemap" href="../sitemap.xml">


<link rel="stylesheet" type="text/css" href="../akasha/epub-website/style.css"><link rel="stylesheet" type="text/css" href="../vendor/bootstrap/css/bootstrap.min.css"><link rel="stylesheet" type="text/css" href="../pulse.min.css"><link rel="stylesheet" type="text/css" href="../style.css"><link rel="stylesheet" type="text/css" href="../vendor/fontawesome-free/css/all.min.css"><link rel="stylesheet" type="text/css" href="../vendor/highlight.js/styles/tomorrow-night-blue.css">


<style>
#container { padding-top: 5px; }
</style>
</head>
<body class="ebook-page">

    <nav class="navbar navbar-expand-lg navbar-dark fixed-top bg-dark d-print-none">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ebookNavbarContent" aria-controls="ebookNavbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="ebookNavbarContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="ebookNavbarAkashaCMSdropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    AkashaCMS
                    </a>
                    <div class="dropdown-menu" aria-labelledby="ebookNavbarAkashaCMSdropdown">
                        <a class="dropdown-item" href="../index.html">Home</a>
                        <a class="dropdown-item" href="../akasharender/toc.html">AkashaRender</a>
                        <a class="dropdown-item" href="../plugins/index.html">Plugins</a>
                        <a class="dropdown-item" href="toc.html">Mahabhuta</a>
                        <a class="dropdown-item" href="../epubtools/toc.html">EPUB Tools</a>
                        <a class="dropdown-item" href="../howto/index.html">How To</a>
                        <a class="dropdown-item" href="../news/index.html">News</a>
                        <a class="dropdown-item" href="../about.html">About</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="ebookNavbarToCdropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Table of Contents
                    </a>
                    <ol type="1" start="1" class="dropdown-menu" aria-labelledby="ebookNavbarToCdropdown">
    <li class="dropdown-item"><a href="introduction.html" id="introduction">Introduction</a></li>
    <li class="dropdown-item"><a href="quickstart.html" id="quickstart" title="Quick start introduction to Mahabhuta">Quick start introduction to Mahabhuta</a></li>
    <li class="dropdown-item"><a href="project-setup.html" id="project-setup">Project Setup</a></li>
    <li class="dropdown-item"><a href="processing.html" id="processing">Processing HTML DOM with Mahabhuta&apos;s Mahafuncs</a></li>
    <li class="dropdown-item"><a href="built-in.html" id="built-in">Using the built-in Mahafuncs</a></li>
    <li class="dropdown-item"><a href="express.html" id="built-in">Using Mahabhuta in an Express application</a></li>
    <li class="dropdown-item"><a href="api.html" id="api">The Mahabhuta API</a></li>
</ol>
                </li>
                <form class="form-inline" action="//www.google.com" id="cse-search-box">
                    <div>
                    <input type="hidden" name="cx" value="partner-pub-2401070691062219:4564101022">
                    <input type="hidden" name="ie" value="UTF-8">
                    <input type="text" name="q" size="30">
                    <input type="submit" name="sa" value="Search">
                    </div>
                </form>
                <script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en">
                // Not empty
                </script>
            </ul>
        </div>
    </nav>

<div id="container" class="container">

    <header class="epub-website-ebook-masthead" id="ebook-masthead">
  <table border="0"><tr>
      
      <td class="epub-website-ebook-masthead-title">
          
      </td>
  </tr></table>
</header>

    <div class="panel panel-default">
        <div class="panel-heading epub-website-ebook-navigation-header" id="ebook-navigation">



<div class="epub-website-ebook-chapter-area">
<a href="project-setup.html">
    <span class="fas fa-chevron-left" aria-hidden="true" style></span>
    <span class="fas fa-chevron-left" aria-hidden="true" style></span>
    <span class="fas fa-chevron-left" aria-hidden="true" style></span>
    <span class="fas fa-chevron-left" aria-hidden="true" style></span>
</a>

<h1 class="panel-title" align="center" style>Processing HTML DOM with Mahabhuta&apos;s Mahafuncs</h1>

<a href="built-in.html">
    <span class="fas fa-chevron-right" aria-hidden="true" style="display: inline"></span>
    <span class="fas fa-chevron-right" aria-hidden="true" style="display: inline"></span>
    <span class="fas fa-chevron-right" aria-hidden="true" style="display: inline"></span>
    <span class="fas fa-chevron-right" aria-hidden="true" style="display: inline"></span>
</a>
</div>

</div>

        <div id="book-page-content" class="panel-body">
            
            <div id="book-page-content" class="panel-body"><p>In the previous chapter we saw a simple one-element MahafuncArray.  We were told that when running <code>mahabhuta.process</code> we&apos;re to pass in a MahafuncArray object.  That&apos;s simple enough, right?  An array of Mahafunc objects, yes?</p>
<h1>MahafuncArray - array&apos;s containing arrays containing arrays</h1>
<p>Of course it&apos;s not that simple.  In AkashaCMS each Plugin is expected to have its own MahafuncArray filled with the Mahafunc&apos;s it supplies.  Therefore a typical AkashaCMS project will have several MahafuncArray&apos;s to deal with.</p>
<p>To deal with that, Mahabhuta allows a MahafuncArray to contain other MahafuncArray instances, and of course these can be nested arbitrarily deep.  It&apos;s kind of like that old Cosmological idea of Universe - that the land is resting on the back of a giant turtle, that&apos;s in turn standing on another turtle, that is in turn standing on another turtle.  In Mahabhuta, it&apos;s MahafuncArray&apos;s all the way down to the bottom.</p>
<p>This means you can create a master MahafuncArray</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> mahamaster = <span class="hljs-keyword">new</span> mahabhuta.MahafuncArray(<span class="hljs-string">&quot;master&quot;</span>, {});
</code></pre>
<p>The <em>master</em> MahafuncArray probably will not need any options, hence the empty options object.</p>
<p>Your code then adds more MahafuncArray&apos;s for each group of Mahafunc&apos;s used in your application.</p>
<pre><code class="hljs language-js">mahamaster.addMahafunc(<span class="hljs-keyword">new</span> mahabhuta.MahafuncArray(<span class="hljs-string">&quot;plugin-1&quot;</span>, {
    <span class="hljs-comment">// options for plugin-1</span>
}));
mahamaster.addMahafunc(<span class="hljs-keyword">new</span> mahabhuta.MahafuncArray(<span class="hljs-string">&quot;plugin-2&quot;</span>, {
    <span class="hljs-comment">// options for plugin-2</span>
}));
</code></pre>
<p>And of course you can call <code>addMahafunc</code> on either of those MahafuncArray objects.</p>
<h2>Adding Mahafunc objects</h2>
<p>You of course don&apos;t just add MahafuncArray instances.  The whole point to this is to define a list of operations we use to process HTML.  We&apos;ve already seen this in the previous chapter.  Generally speaking, we do this:</p>
<pre><code class="hljs language-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OurCustomElement</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">mahabhuta</span>.<span class="hljs-title">CustomElement</span> </span>{
    <span class="hljs-keyword">get</span> elementName() { <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;our-custom-element&quot;</span>; }
    <span class="hljs-keyword">async</span> process($element, metadata, dirty) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Custom Element Content&quot;</span>;
    }
}
mahamaster.addMahafunc(<span class="hljs-keyword">new</span> OurCustomElement());
</code></pre>
<p>We add an instance of the class rather than the class.  That is, we call <code>new OurClassName()</code> rather than just passing in <code>OurClassName</code>.</p>
<h2>The result: HTML in, changed HTML out</h2>
<p>The purpose for Mahabhuta is to manipulate HTML:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> mahabhuta.processAsync(HTMLINPUT, {
    <span class="hljs-comment">// metadata for the HTMLINPUT</span>
}, mahafuncs);
</code></pre>
<p>The <em>metadata</em> object is available for the various Mahafunc&apos;s to use and possibly insert into the text result.</p>
<p>The Mahabhuta library offers two versions of <code>process</code>.  The <code>process</code> function uses the traditional callback API, while <code>processAsync</code> returns a Promise and is therefore useful when called inside an <code>async/await</code> function.</p>
<p>Under the covers in each Mahafunc, the <code>process</code> function is an async function and therefore handles asynchronous code exeuction.</p>
<h2>Order of execution</h2>
<p>Each MahafuncArray and each Mahafunc within a MahafuncArray are executed in the order in which they&apos;re added.  Later additions go to the end of the list, and are executed later than the earlier additions.</p>
<p>Because every Mahafunc <code>process</code> function is an <code>async</code> function, asynchronous execution is handled automatically.</p>
<h2>Overriding a Mahafunc</h2>
<p>Suppose you&apos;re using a MahafuncArray providing a group of useful Mahafuncs, and you like the behavior of all but one.  It&apos;s a wonderful set of Mahafunc&apos;s, but that one -- if only it were a little different.  Mahabhuta allows you to override a Mahafunc simply by implementing a different version in an earlier MahafuncArray.</p>
<p>What did I mean by that?  Typically your application uses multiple MahafuncArray&apos;s.  If there are two Mahafunc&apos;s dealing with the same task, the one which executes first will take care of the task, and the one which executes later will not.  Hence, the first one overrides the second.</p>
<p>This is <em>over-rideability principle</em>, meaning that every available action or template must be capable of being overridden.</p>
<p>For example, consider a second CustomElement Mahafunc for the <code>hello-world</code> tag we looked at earlier.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> mahafuncs = <span class="hljs-keyword">new</span> mahabhuta.MahafuncArray(<span class="hljs-string">&quot;example&quot;</span>, {});

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorld</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">mahabhuta</span>.<span class="hljs-title">CustomElement</span> </span>{
    <span class="hljs-keyword">get</span> elementName() { <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello-world&quot;</span>; }
    <span class="hljs-keyword">async</span> process($element, metadata, dirty) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello, happy world!&quot;</span>;
    }
}
mahafuncs.addMahafunc(<span class="hljs-keyword">new</span> HelloWorld());
</code></pre>
<p>Both of these declare they work on the <code>&lt;hello-world&gt;</code> tag.  But when does the output say <code>Hello, world</code> and when does it say <code>Hello, happy world</code>?  The answer depends on which is executed first.  That&apos;s because a CustomElement Mahafunc replaces its tag with the result text (we&apos;ll go over this in a second).</p>
<p>One of those <code>&lt;hello-world&gt;</code> implementations will execute before the other.  The first one to execute replaces <code>&lt;hello-world&gt;</code> with its text.  When the second executes the tag is no longer there and the Mahafunc doesn&apos;t perform any work.</p>
<h2>Determining which Mahafunc is failing</h2>
<p>This system of MahafuncArray&apos;s containing other MahafuncArray&apos;s is very flexible and efficient.  But certain failures in Mahafunc&apos;s can be extremely difficult to debug.  A Mahafunc that doesn&apos;t exit properly can simply cause AkashaRender to exit with no indication of the cause of the failure.</p>
<p>Mahabhuta allows you to trace the processing of MahafuncArray&apos;s and Mahafunc&apos;s.  If a Mahafunc fails incorrectly, it will be the last one printed by this tracing.  Or the tracing helps you audit the behavior of Mahabhuta in your application.</p>
<p>Somewhere in your application call <code>mahabhuta.setTraceProcessing(true)</code> as so:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> mahabhuta = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;mahabhuta&apos;</span>);
mahabhuta.setTraceProcessing(<span class="hljs-literal">true</span>);
</code></pre>
<p>When set, the Mahabhuta processing loop will print this sort of tracing:</p>
<pre><code class="hljs">Mahabhuta starting<span class="hljs-built_in"> array </span>master
Mahabhuta starting<span class="hljs-built_in"> array </span>inline
Mahabhuta calling an inline <span class="hljs-string">&quot;function&quot;</span>
Mahabhuta starting<span class="hljs-built_in"> array </span>akashacms-base
Mahabhuta calling CustomElement akashacms-base ak-page-title
Mahabhuta calling CustomElement akashacms-base ak-header-metatags
Mahabhuta calling CustomElement akashacms-base ak-sitemapxml
Mahabhuta calling CustomElement akashacms-base ak-header-linkreltags
Mahabhuta calling CustomElement akashacms-base ak-header-canonical-url
Mahabhuta calling an akashacms-base <span class="hljs-string">&quot;function&quot;</span>
Mahabhuta calling CustomElement akashacms-base ak-google-analytics
Mahabhuta calling CustomElement akashacms-base<span class="hljs-keyword"> public</span>ation-date
Mahabhuta calling an akashacms-base <span class="hljs-string">&quot;function&quot;</span>
Mahabhuta calling Munger akashacms-base html head open-graph-promote-images
Mahabhuta calling an akashacms-base <span class="hljs-string">&quot;function&quot;</span>
Mahabhuta starting<span class="hljs-built_in"> array </span>inline
Mahabhuta calling an inline <span class="hljs-string">&quot;function&quot;</span>
Mahabhuta starting<span class="hljs-built_in"> array </span>inline
Mahabhuta calling an inline <span class="hljs-string">&quot;function&quot;</span>
Mahabhuta calling an inline <span class="hljs-string">&quot;function&quot;</span>
Mahabhuta starting<span class="hljs-built_in"> array </span>akashacms-document-viewers
Mahabhuta calling CustomElement akashacms-document-viewers googledocs-viewer
Mahabhuta calling CustomElement akashacms-document-viewers googledocs-view-link
Mahabhuta calling CustomElement akashacms-document-viewers docviewer
Mahabhuta calling CustomElement akashacms-document-viewers docviewer-link
</code></pre>
<p>Turning off the tracing is this simple:</p>
<pre><code class="hljs language-js">mahabhuta.setTraceProcessing(<span class="hljs-literal">false</span>);
</code></pre>
<h1>The Mahafunc objects</h1>
<p>Currently there are two kinds of Mahafunc&apos;s, and a third type we might implement if it makes sense to do so.  We&apos;ve already seen one, CustomElement, which is meant to process a single element in the DOM, replacing it with something else.  The other, Munger, is meant for wider-ranging changes to the DOM.</p>
<p>Each sort of Mahafunc receives a jQuery-like object representing the DOM.  It supports a subset of the jQuery API, supporting DOM manipulations using familiar jQuery methods.</p>
<h2>CustomElement</h2>
<p>We&apos;ve already looked at this object, without discussing any of the details.  Let&apos;s do that now.</p>
<p>The <code>elementName</code> method is a getter, and it defines the name of the element provided by this CustomElement instance.  As we saw in the Hello World example, with a CustomElement defined our HTML can contain a tag, <code>&lt;our-custom-element&gt;</code>.  When Mahabhuta executes each CustomElement instance, it scans the DOM as if this were executed:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">var</span> elements = [];
$(<span class="hljs-string">&apos;our-custom-element&apos;</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">i, elem</span>) </span>{ ret.push(elem); });
</code></pre>
<p>For each element pushed to the <code>elements</code> array, Mahabhuta calls the <code>process</code> function.  The <code>$element</code> parameter gets <code>$(element)</code>, and the <code>metadata</code> parameter is passed through unchanged.</p>
<p>The <code>dirty</code> parameter is a function you are to call if your CustomElement inserts HTML which requires further processing.  You might add HTML that itself is meant to be processed by another Mahafunc.  If that&apos;s the case, call <code>dirty()</code> in your function.  If this function gets called, Mahabhuta will make sure to run all the Mahafunc&apos;s another time.</p>
<p>Your <code>process</code> function should be declared <code>async</code>.  Under the covers it returns a Promise that either resolve&apos;s or reject&apos;s depending on the result.  Mahabhuta will capture both errors and good results and act appropriately.</p>
<p>The action taken with the result depends on the Mahafunc subclass used.  For CustomElement, the action taken is:</p>
<pre><code class="hljs language-js">$(element).replaceWith(html);
</code></pre>
<p>Bottom line:  CustomElement objects are meant to implement, as the name implies, a custom HTML element which is completely replaced by other HTML code.</p>
<h3>Naming CustomElement implementations</h3>
<p>It&apos;s useful for your custom HTML elements to not collide with the regular HTML elements.  Unless, that is, you want to override a regular HTML element with your custom implementation.  For example you might want a CustomElement to replace old-school <code>&lt;i&gt;</code> or <code>&lt;b&gt;</code> tags with the new-school <code>&lt;em&gt;</code> and <code>&lt;strong&gt;</code> tags.  But, normally, you&apos;ll want to leave the regular HTML tags alone, and ensure your custom tags do not collide.</p>
<p>A simple policy is to use the <code>-</code> character in the <code>elementName</code>.  That&apos;s because all (or most) of the standard regular HTML elements do not have <code>-</code> in their element name.</p>
<p>Et voila, by using <code>-</code> in the <code>elementName</code> you&apos;re almost certainly assured of no naming collision.</p>
<p>Since there&apos;s an exception to every rule, the Mahabhuta built-in Mahafunc&apos;s does include a tag, <code>&lt;partial&gt;</code>, which does not follow this rule.  Live with it, since <code>&lt;partial&gt;</code> is the best name for that tag.</p>
<h3>Data and parameters</h3>
<p>Being an HTML element, the HTML matching your CustomElement can of course have attributes.</p>
<pre><code class="hljs language-html"><span class="hljs-tag">&lt;<span class="hljs-name">our-custom-element</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://akashacms.com&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">our-custom-element</span>&gt;</span>
</code></pre>
<p>Which you can retrieve as so:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">async</span> process($element, metadata, dirty) {
    <span class="hljs-keyword">const</span> href = $element.attr(<span class="hljs-string">&apos;href&apos;</span>);
    ...
}
</code></pre>
<p>You can also retrieve metadata values:</p>
<pre><code class="hljs language-js">mahabhuta.process(htmlSource, {
    <span class="hljs-attr">href</span>: <span class="hljs-string">&quot;http://akashacms.com&quot;</span>,
    <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;AkashaCMS&quot;</span>
}, mahafuncs, (err, html) =&gt; {
    <span class="hljs-keyword">if</span> (err) <span class="hljs-built_in">console</span>.error(err);
    <span class="hljs-keyword">else</span> ...
});
</code></pre>
<p>Then access the values as so</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">async</span> process($element, metadata, dirty) {
    ...
    const href = metadata.href;
    <span class="hljs-keyword">const</span> title = metadata.title;
    ...
}
</code></pre>
<h2>Munger</h2>
<p>Munger objects are meant to implement broader changes to the HTML.  For example you might want to &quot;clean up&quot; certain HTML code, or wrap certain code with some other HTML, or to insert some HTML elsewhere, or to move HTML from one place to another, and so forth.  The jQuery API is powerful, and we want you to use all of it in processing HTML.</p>
<pre><code class="hljs language-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OurMungerClass</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">mahabhuta</span>.<span class="hljs-title">Munger</span> </span>{
	<span class="hljs-keyword">get</span> selector() { <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;jQuery Selector&quot;</span>; }

	<span class="hljs-keyword">async</span> process($, $match, metadata, dirty) {
    }
}
</code></pre>
<p>Instead of an element name, we&apos;re to supply a <code>selector</code>.  This is a full normal jQuery-style selector so go wild with it.</p>
<p>For each match to the selector, the <code>process</code> function is called.  The <code>metadata</code> and <code>dirty</code> parameters are as before.</p>
<p>The <code>$</code> parameter is the jQuery-like object representing the entire DOM.  You can call any jQuery function on this object which Cheerio supports.  While Cheerio supports a very large subset of jQuery, it has its limits.</p>
<p>The <code>$match</code> parameter is the <code>$(element)</code> entry that was scanned using the <code>selector</code>.</p>
<p>As before, the <code>process</code> function is to return a Promise.  Unlike CustomElement, the content returned by the Promise is not used.  You must of course indicate failure by rejecting the Promise, and success with the resolve method.</p>
<p>What you do within the <code>process</code> method is up to you.  Have fun.</p>
<h2>A warning about <code>dirty()</code> infinite loops</h2>
<p>It&apos;s quite possible to lead Mahabhuta into an infinite loop:</p>
<pre><code class="hljs language-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InfiniteLoop</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">mahabhuta</span>.<span class="hljs-title">Munger</span> </span>{
	<span class="hljs-keyword">get</span> selector() { <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;body&quot;</span>; }

	<span class="hljs-keyword">async</span> process($, $match, metadata, dirty) {
        dirty();
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;infinite loop&quot;</span>;
    }
}
</code></pre>
<p>Don&apos;t do this.  Because Mahabhuta always ensures it&apos;ll re-run the Mahafunc&apos;s another time when <code>dirty</code> is called, this Mahafunc ensures Mahabhuta will never stop.</p>
<p>There are a number of ways to create such a situation.</p>
<h1>Backwards compatibility - adding bare functions and Array&apos;s</h1>
<p>For backwards compatibility with existing AkashaCMS code, Mahabhuta also supports adding simple function&apos;s (with a predefined signature), and simple Array&apos;s (which must contain Mahafunc&apos;s or the equivalent function).</p>
<p>The function signature is as so:</p>
<pre><code class="hljs language-js">mahafunc($, metadata, dirty, next);
</code></pre>
<p>These parameters are all as we&apos;ve seen above, except for <code>next</code>.  This is an old style callback function supplied by Mahabhuta.  You&apos;re to call it either as <code>next(error)</code> to indicate an error, or <code>next()</code> to indicate success.</p>
<p>When calling <code>mahabhuta.process</code> the <code>mahafuncs</code> parameter can be an Array.  Internally this is converted to a MahafuncArray.</p>
</div>
            


            <div class="panel-heading epub-website-ebook-navigation-header" id="ebook-navigation-bottom">



<div class="epub-website-ebook-chapter-area">
<a href="project-setup.html">
    <span class="fas fa-chevron-left" aria-hidden="true" style></span>
    <span class="fas fa-chevron-left" aria-hidden="true" style></span>
    <span class="fas fa-chevron-left" aria-hidden="true" style></span>
    <span class="fas fa-chevron-left" aria-hidden="true" style></span>
</a>

<h1 class="panel-title" align="center" style>Processing HTML DOM with Mahabhuta&apos;s Mahafuncs</h1>

<a href="built-in.html">
    <span class="fas fa-chevron-right" aria-hidden="true" style="display: inline"></span>
    <span class="fas fa-chevron-right" aria-hidden="true" style="display: inline"></span>
    <span class="fas fa-chevron-right" aria-hidden="true" style="display: inline"></span>
    <span class="fas fa-chevron-right" aria-hidden="true" style="display: inline"></span>
</a>
</div>

</div>

            <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'akashacms'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the 
                    <img class="akashacms-external-links-favicon opengraph-no-promote" src="https://www.google.com/s2/favicons?domain=disqus.com" style="display: inline-block; padding-right: 2px;" alt="(disqus.com)">
                    <a href="https://disqus.com/?ref_noscript" rel="nofollow" target="_blank">comments powered by Disqus.</a></noscript>

                    <img class="akashacms-external-links-favicon opengraph-no-promote" src="https://www.google.com/s2/favicons?domain=disqus.com" style="display: inline-block; padding-right: 2px;" alt="(disqus.com)">
                    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow" target="_blank">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
    </div>
    <footer id="footer-row" class="container">
    

<a rel="nofollow noskim" href="https://www.amazon.com/gp/product/1785881507/ref=as_li_ss_il?ie=UTF8&amp;fpl=fresh&amp;pf_rd_m=ATVPDKIKX0DER&amp;pf_rd_s=&amp;pf_rd_r=6C1SVA4RRTWPTY7VN1Z2&amp;pf_rd_t=36701&amp;pf_rd_p=14bf09e4-93c8-43ff-8639-e7979e7d1787&amp;pf_rd_i=desktop&amp;linkCode=li2&amp;tag=davidherron-20&amp;linkId=1a83c9a47355206fbe8622bf9e90b086" target="_blank"><img border="0" src="https://ws-na.amazon-adsystem.com/widgets/q?_encoding=UTF8&amp;ASIN=1785881507&amp;Format=_SL250_&amp;ID=AsinImage&amp;MarketPlace=US&amp;ServiceVersion=20070822&amp;WS=1&amp;tag=techsparx-20" width="175"></a>

<a rel="nofollow noskim" href="https://www.amazon.com/Asynchronous-Node-js-JavaScript-Promises-Generators-ebook/dp/B01N2Z4SOR/ref=as_li_ss_tl?ie=UTF8&amp;qid=1498526267&amp;sr=8-1&amp;keywords=asynchronous+javascript+promises+generators&amp;linkCode=ll1&amp;tag=techsparx-20&amp;linkId=0b8a5dc44c97bf8eb8452dac15ae724b" target="_blank"><img border="0" src="https://techsparx.com/nodejs/img/es-2015-16-17-promises-generators-and-async-await-2-1000.jpg" width="175"></a>

<a rel="nofollow noskim" href="https://www.amazon.com/Creating-eBooks-Markdown-Source-Tools-ebook/dp/B00WTKDH72/ref=as_li_ss_tl?_encoding=UTF8&amp;psc=1&amp;refRID=4SGHASEAZJKJBV0G60R0&amp;linkCode=ll1&amp;tag=techsparx-20&amp;linkId=941071a7b25f067767f82a7b11c06968" target="_blank"><img border="0" src="https://techsparx.com/nodejs/img/create-ebook-cover.jpg" width="175"></a>

    
<div class="fb-like-box" data-href="http://www.facebook.com/Akashacms" data-width="125" data-height="250" data-show-faces="false" data-stream="false" data-header="true"></div>

    </footer>
</div>

<script src="../vendor/jquery/jquery.min.js"></script><script src="../vendor/popper.js/umd/popper.min.js"></script><script src="../vendor/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-37003917-1']);
  _gaq.push(['_setDomainName', 'akashacms.com']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- partial file-name="piwik_analytics.html"></partial -->


</body>
</html>
