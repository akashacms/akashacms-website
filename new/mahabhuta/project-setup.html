<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width">
<title>Project setup</title>
<meta name="pagename" content="Project setup">
<meta name="date" content="Mon May 15 2017 13:52:40 GMT-0700 (PDT)">
<meta name="DC.title" content="Project setup">
<meta name="og:title" content="Project setup">
<meta name="og:url" content="https://akashacms.com/new/mahabhuta/project-setup.html">
<link rel="canonical" href="https://akashacms.com/new/mahabhuta/project-setup.html">
<link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml">
<link rel="stylesheet" type="text/css" href="/akasha/epub-website/style.css"><link rel="stylesheet" type="text/css" href="/vendor/bootstrap/css/bootstrap.min.css"><link rel="stylesheet" type="text/css" href="/vendor/bootstrap/css/bootstrap-theme.min.css"><link rel="stylesheet" type="text/css" href="/readable.min.css"><link rel="stylesheet" type="text/css" href="/style.css">
<style>
html, body {
    height:100%;
    max-height:100%;
    margin:0;
}

#page-container {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    flex-wrap: nowrap;
}

#site-navbar {
    display: none;
    flex-shrink: 0;
    height: 30px;
}

#ebook-masthead {
    flex-shrink: 0;
    height: 60px;
}

#ebook-masthead h2 {
    font-size: 22px;
    margin-top: 0px;
}

#ebook-navigation {
    flex-shrink: 0;
    height: 60px;
}

#book-page-content {
    flex-grow: 1;
    overflow: auto;
    min-height: 2em;
}

#footer-row {
    display: none;
    flex-shrink: 0;
    height: 50px;
    background-color: grey;
}
</style>
</head>
<body class="ebook-page">
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
<button class="navbar-toggle" data-toggle="collapse" data-target=".navHeaderCollapse">
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<div class="navbar-collapse collapse navHeaderCollapse">
<ul class="nav navbar-nav navbar-rights">
<li><a href="/new/index.html">Home</a></li>
<li><a href="/new/akasharender/toc.html">AkashaRender</a></li>
<li><a href="/new/plugins/index.html">Plugins</a></li>
<li><a href="/new/mahabhuta/toc.html">Mahabhuta</a></li>
<li><a href="/new/epubtools/toc.html">EPUB Tools</a></li>
</ul>
</div>
</div>
<div id="page-container">
<header class="epub-website-ebook-masthead" id="ebook-masthead">
<table border="0"><tr>
<td class="epub-website-ebook-masthead-title">
<a href="/new/mahabhuta/toc.html"><h2 align="center">Mahabhuta - DOM-processing on the server in Node.js</h2></a><em>By David Herron</em>
</td>
</tr></table>
</header>
<div class="panel panel-default">
<div class="panel-heading epub-website-ebook-navigation-header" id="ebook-navigation">
<div class="epub-website-ebook-logo-area">
<div class="btn-group">
<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span>
Table of Contents
<span class="caret"></span>
</button>
<ol type="1" start="1" class="dropdown-menu">
<li><a href="introduction.html" id="introduction">Introduction</a></li>
<li><a href="project-setup.html" id="project-setup">Project Setup</a></li>
<li><a href="processing.html" id="processing">Processing HTML DOM with Mahabhuta&apos;s Mahafuncs</a></li>
<li><a href="built-in.html" id="built-in">Using the built-in Mahafuncs</a></li>
<li><a href="express.html" id="built-in">Using Mahabhuta in an Express application</a></li>
<li><a href="api.html" id="api">The Mahabhuta API</a></li>
</ol>
</div>
</div>
<div class="epub-website-ebook-chapter-area">
<a href="introduction.html">
<span class="epub-website-ebook-chevron-left glyphicon glyphicon-chevron-left" aria-hidden="true" style=""></span>
</a>
<h1 class="panel-title" align="center" style="">Project setup</h1>
<a href="processing.html">
<span class="glyphicon glyphicon-chevron-right" aria-hidden="true" style="display: inline"></span>
</a>
</div>
</div>
<div id="book-page-content" class="panel-body">
<div id="book-page-content" class="panel-body"><h1>Setting up Node.js</h1>
<p>Mahabhuta is written for the Node.js platform. That means it executes JavaScript programs, letting you leverage your jQuery and JavaScript knowledge on server-side software. Therefore the first step is to set up Node.js on your laptop and/or server.</p>
<p>I won&apos;t go into this in very much depth because there is excellent documentation elsewhere.</p>
<ul>
<li>Official download location: <a href="https://nodejs.org/en/download/">https://nodejs.org/en/download/</a></li>
<li>Official documentation on installing from O/S package managers: <a href="https://nodejs.org/en/download/package-manager">https://nodejs.org/en/download/package-manager</a></li>
<li>Comprehensive list of books and video courses on Node.js programming: <a href="http://davidherron.com/book/2015-09-14/books-and-videos-so-you-can-easily-learn-nodejs-programming">http://davidherron.com/book/2015-09-14/books-and-videos-so-you-can-easily-learn-nodejs-programming</a></li>
<li>NVM is an excellent tool for managing Node.js versions on your laptop: <a href="https://github.com/creationix/nvm">https://github.com/creationix/nvm</a></li>
</ul>
<h1>Initializing a Mahabhuta project</h1>
<p>Your use of Mahabhuta is probably going to be part of a larger project. For example, while Mahabhuta is a major feature in AkashaCMS it is not the entirety of that project.</p>
<p>Every Node.js project starts with running this command:</p>
<pre><code>$ npm init
</code></pre>
<p>This initializes a <code>package.json</code> file with a few basic settings. The <code>package.json</code> describes the project, its dependencies, and can even describe the processes you can do with the project.</p>
<p>You declare the Mahabhuta dependency as so:</p>
<pre><code>$ npm install &quot;akashacms/mahabhuta#akasharender&quot; --save
</code></pre>
<p>At the moment the Mahabhuta version documented in this book is available solely as the <code>akasharender</code> branch in the workspace. In the due course of time this version of Mahabhuta will be available in the npm repository.</p>
<h1>A small Mahabhuta example</h1>
<p>In an empty directory, create a file named <code>hello-world.js</code> containing the following:</p>
<pre><code>&apos;use strict&apos;;

const mahabhuta = require(&apos;mahabhuta&apos;);

var mahafuncs = new mahabhuta.MahafuncArray(&quot;example&quot;, {});

class HelloWorld extends mahabhuta.CustomElement {
	get elementName() { return &quot;hello-world&quot;; }
	process($element, metadata, dirty) {
		return Promise.resolve(&quot;Hello, world!&quot;);
	}
}
mahafuncs.addMahafunc(new HelloWorld());

mahabhuta.config({
    recognizeSelfClosing: true,
    recognizeCDATA: true
});

mahabhuta.process(`
    &lt;html&gt;
    &lt;head&gt;
    &lt;title&gt;Hi&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
    &lt;hello-world&gt;&lt;/hello-world&gt;
    &lt;/body&gt;
    &lt;/html&gt;
`, {}, mahafuncs, (err, html) =&gt; {
    if (err) console.error(err);
    else console.log(html);
});
</code></pre>
<p>In that directory run:</p>
<pre><code>$ npm init
    answer all the questions
$ npm install akashacms/mahabhuta#akasharender --save
$ node ..hello-world
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Hi&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
Hello, world!
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Notice that the tag, <code>&lt;hello-world&gt;</code>, was replaced by the text: <code>Hello, world!</code></p>
<pre><code>var mahafuncs = new mahabhuta.MahafuncArray(&quot;example&quot;, {});

class HelloWorld extends mahabhuta.CustomElement {
	get elementName() { return &quot;hello-world&quot;; }
	process($element, metadata, dirty) {
		return Promise.resolve(&quot;Hello, world!&quot;);
	}
}
mahafuncs.addMahafunc(new HelloWorld());
</code></pre>
<p>The <code>MahafuncArray</code> object is used to store an array of what we call, for lack of a better name, Mahafunc&apos;s. A Mahafunc is the unit of processing in Mahabhuta. There is a base class, Mahafunc, and two subclasses one of which we see here, CustomElement.</p>
<p>CustomElement instances match elements named by the <code>elementName</code> method. For each matching element the <code>process</code> function is called, and the result of the Promise it returns are inserted into the output.</p>
<p>What we&apos;ve done is define a MahafuncArray containing one Mahafunc.</p>
<pre><code>mahabhuta.config({
    recognizeSelfClosing: true,
    recognizeCDATA: true
});
</code></pre>
<p>This does some necessary configuration of Mahabhuta. Under the covers it uses Cheerio, and the configuration parameters are actually Cheerio&apos;s.</p>
<pre><code>mahabhuta.process(`
    &lt;html&gt;
    &lt;head&gt;
    &lt;title&gt;Hi&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
    &lt;hello-world&gt;&lt;/hello-world&gt;
    &lt;/body&gt;
    &lt;/html&gt;
`, {}, mahafuncs, (err, html) =&gt; {
    if (err) console.error(err);
    else console.log(html);
});
</code></pre>
<p>Here we process some HTML, using the MahafuncArray we just defined. The second parameter is a metadata object, whose contents can be used to pass data into the Mahafunc&apos;s. The callback either gives an error, or some HTML.</p>
<p>This should give a taste of what you can do with Mahabhuta. In the next chapter we&apos;ll go more deeply into what it can do.</p>
<h1>etc</h1>
<p>Using Mahabhuta in an AkashaCMS project ?? separate page ??</p>
<p>Using Mahabhuta in an EPUBTools project ?? seperate page ??</p>
</div>
<div class="panel-heading epub-website-ebook-navigation-header" id="ebook-navigation-bottom">
<div class="epub-website-ebook-logo-area">
<div class="btn-group">
<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span>
Table of Contents
<span class="caret"></span>
</button>
<ol type="1" start="1" class="dropdown-menu">
<li><a href="introduction.html" id="introduction">Introduction</a></li>
<li><a href="project-setup.html" id="project-setup">Project Setup</a></li>
<li><a href="processing.html" id="processing">Processing HTML DOM with Mahabhuta&apos;s Mahafuncs</a></li>
<li><a href="built-in.html" id="built-in">Using the built-in Mahafuncs</a></li>
<li><a href="express.html" id="built-in">Using Mahabhuta in an Express application</a></li>
<li><a href="api.html" id="api">The Mahabhuta API</a></li>
</ol>
</div>
</div>
<div class="epub-website-ebook-chapter-area">
<a href="introduction.html">
<span class="epub-website-ebook-chevron-left glyphicon glyphicon-chevron-left" aria-hidden="true" style=""></span>
</a>
<h1 class="panel-title" align="center" style="">Project setup</h1>
<a href="processing.html">
<span class="glyphicon glyphicon-chevron-right" aria-hidden="true" style="display: inline"></span>
</a>
</div>
</div>
<div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'akashacms'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
</div>
<footer id="footer-row" class="container">
<div class="fb-like-box" data-href="http://www.facebook.com/Akashacms" data-width="125" data-height="250" data-show-faces="false" data-stream="false" data-header="true"></div>
</footer>
</div>
<script src="/vendor/jquery/jquery.min.js"></script><script src="/vendor/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript">
var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-37003917-1']);
  _gaq.push(['_setDomainName', 'akashacms.com']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>
