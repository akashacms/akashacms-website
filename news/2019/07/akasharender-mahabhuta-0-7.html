<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!-- Consider adding a manifest.appcache: h5bp.com/d/Offline -->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width">

<title>Announcing 0.7 release of AkashaRender and Mahabhuta</title>





 
 
 
 













<meta name="pagename" content="Announcing 0.7 release of AkashaRender and Mahabhuta">









<meta name="date" content="Sat Aug 08 2020 22:56:59 GMT-0700 (Pacific Daylight Time)">

<meta name="DC.title" content="Announcing 0.7 release of AkashaRender and Mahabhuta">














<!-- OpenGraph Meta Tags -->

<meta name="og:title" content="Announcing 0.7 release of AkashaRender and Mahabhuta">

<meta name="og:url" content="https://akashacms.com/news/2019/07/akasharender-mahabhuta-0-7.html">


































<link rel="canonical" href="https://akashacms.com/news/2019/07/akasharender-mahabhuta-0-7.html">

<link rel="sitemap" type="application/xml" title="Sitemap" href="../../../sitemap.xml">


<link rel="stylesheet" type="text/css" href="../../../akasha/epub-website/style.css"><link rel="stylesheet" type="text/css" href="../../../vendor/bootstrap/css/bootstrap.min.css"><link rel="stylesheet" type="text/css" href="../../../pulse.min.css"><link rel="stylesheet" type="text/css" href="../../../style.css"><link rel="stylesheet" type="text/css" href="../../../vendor/fontawesome-free/css/all.min.css"><link rel="stylesheet" type="text/css" href="../../../vendor/highlight.js/styles/tomorrow-night-blue.css">



<!-- Facebook app for AkashaCMS fan page -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=234745903279111";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



<!-- Twitter summary card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@akashacms">
<meta name="twitter:creator" content="@7genblogger">

<meta name="twitter:url" content="https://akashacms.com/news/2019/07/akasharender-mahabhuta-0-7.html">


<meta name="twitter:title" content="Announcing 0.7 release of AkashaRender and Mahabhuta">


<meta name="twitter:image" content="http://akashacms.com/logo.gif">


</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top" role="navigation">
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarNavDropdown">
    <ul class="navbar-nav navbar-rights">
          <li class="nav-item">
              <a class="nav-link" href="../../../index.html">Home</a>
          </li>
          <li class="nav-item">
              <a class="nav-link" href="../../../akasharender/toc.html">AkashaRender</a>
          </li>
          <li class="nav-item">
              <a class="nav-link" href="../../../plugins/index.html">Plugins</a>
          </li>
          <li class="nav-item">
              <a class="nav-link" href="../../../mahabhuta/toc.html">Mahabhuta</a>
          </li>
          <li class="nav-item">
              <a class="nav-link" href="../../../epubtools/toc.html">EPUB Tools</a>
          </li>
          <li class="nav-item">
              <a class="nav-link" href="../../../howto/index.html">How To</a>
          </li>
          <li class="nav-item">
              <a class="nav-link" href="../../index.html">News</a>
          </li>
          <li class="nav-item">
              <a class="nav-link" href="../../../about.html">About</a>
          </li>
    </ul>
  </div>
</nav>


<div class="container" role="main">
<div class="row">
<header class="col-md-12">
  <div class="row">
    <span class="col-md-8" style="text-align: center;">
      <a href="../../../index.html"><img src="../../../logo.gif" align="left"></a>
      <h1 align="center">Announcing 0.7 release of AkashaRender and Mahabhuta</h1>
    </span>
    <span class="col-md-4">
      <form action="//www.google.com" id="cse-search-box">
        <div>
          <input type="hidden" name="cx" value="partner-pub-2401070691062219:4564101022">
          <input type="hidden" name="ie" value="UTF-8">
          <input type="text" name="q" size="30">
          <input type="submit" name="sa" value="Search">
        </div>
      </form>
      <script type="text/javascript" src="//www.google.com/coop/cse/brand?form=cse-search-box&amp;lang=en">
      // Not empty
      </script>
      <br>

    </span>
  </div>

</header>

</div>

<div class="row">
  <section id="breadcrumb" class="col-sm-12">
    <nav aria-label="breadcrumb" id="breadcrumbTrail">
    <ol class="breadcrumb">
     <li class="breadcrumb-item "> <a href="../../../index.html">AkashaCMS - the powerful static file CMS to build your dream website</a> </li> <li class="breadcrumb-item "> <a href="../../index.html">Announcements and News about AkashaCMS</a> </li> <li class="breadcrumb-item "> <a href="../index.html">AkashaCMS News and Announcements for 2019</a> </li> <li class="breadcrumb-item "> <a href="index.html">July 2019</a> </li> <li class="breadcrumb-item "> <a href="akasharender-mahabhuta-0-7.html">Announcing 0.7 release of AkashaRender and Mahabhuta</a> </li>
    </ol>
</nav>

  </section>
  <section id="category-tags" class="col-sm-12">
    
    Date: July 17, 2019

  </section>
  <section id="author-byline" class="col-sm-12">
    <div class="author-byline" itemprop="author" itemscope itemtype="http://schema.org/Person">
By <span itemprop="name" class="author-name-wrapper"><a href="../../../about.html" rel="author" itemprop="url">David Herron</a></span>
</div>

  </section>
</div>

<div class="row">
  <article class="col-sm-10">
    
    <strong><p><strong>A major change was made to the AkashaRender and Mahabhuta API&apos;s back in March/April.  I had held back on publishing an update to these modules but they&apos;ve been in use long enough to prove their stability.  The changes improve configuration files, and make it easier to reuse MahabhutaArray&apos;s outside of an AkashaRender project.
</strong></p>
</strong>
    
    <!-- no hero picture -->

    <p>The move from 0.6 to 0.7 took about 2 years.  That&apos;s not quite right, but is a reflection that my primary focus is on using AkashaCMS to build my websites rather than to develop AkashaCMS as a product.</p>
<h1>Changes in AkashaRender</h1>
<h2>Implemented AsciiDoc support</h2>
<p>AkashaCMS was originally designed around rendering Markdown documents to web pages.  But I learned that AsciiDoc is a very powerful alternate to Markdown.  To use an AsciiDoctor document simply name it with an extension <code>.html.adoc</code> and AkashaRender will render it to HTML.</p>
<h2>Parallelized rendering</h2>
<p>While exploring why some of my websites rendered so slowly, it dawned on me that AkashaRender did not make use of parallel processing.  The Node.js platform has excellent support for event driven parallelism.  In a web service context that means Node.js supports multiple concurrent requests from client programs, and interleaves processing those requests.</p>
<p>For a CLI program like AkashaRender - it didn&apos;t occur to me this would help.  But I rewrote the <code>render</code> function to process documents in parallel.  Rather than simply throwing the array of documents into <code>Promise.all</code>, I used the <code>parallelLimit</code> module to have a controlled amount of parallelism.</p>
<p>After testing running <code>n</code> renders in parallel, it seemed the sweet spot was processing about 7 or 8 documents at a time.</p>
<p>The concurrency level is set in <code>config.js</code> with the <code>setConcurrency</code> function.  It defaults to a concurrency of <code>3</code>.</p>
<h2>Improved report at end of rendering a website</h2>
<p>In the past the report of files rendered was disorganized, with the steps for the rendering of each file being reported semi-randomly.</p>
<p>The new output format reports each rendering stage for a file immediately after the previous stage of that file.  It lets us directly see how long it took to render a given file, and what steps were involved.</p>
<pre><code class="hljs">.html.md <span class="hljs-regexp">/home/</span>docker<span class="hljs-regexp">/jenkins/</span>workspace<span class="hljs-regexp">/greentransportation.info/</span>ev-charging<span class="hljs-regexp">/range-confidence/</span>chap4-charging<span class="hljs-regexp">/4-charging-levels.html.md ==&gt; /</span>home<span class="hljs-regexp">/docker/</span>jenkins<span class="hljs-regexp">/workspace/</span>greentransportation.info<span class="hljs-regexp">/out/</span>ev-charging<span class="hljs-regexp">/range-confidence/</span>chap4-charging/<span class="hljs-number">4</span>-charging-levels.html (<span class="hljs-number">0.336</span> seconds)
<span class="hljs-regexp">/home/</span>docker<span class="hljs-regexp">/jenkins/</span>workspace<span class="hljs-regexp">/greentransportation.info/</span>ev-charging range-confidence<span class="hljs-regexp">/chap4-charging/</span><span class="hljs-number">4</span>-charging-levels.html.md <span class="hljs-regexp">/home/</span>docker<span class="hljs-regexp">/jenkins/</span>workspace<span class="hljs-regexp">/greentransportation.info/</span>out/ev-charging FRONTMATTER <span class="hljs-number">0</span> seconds
<span class="hljs-regexp">/home/</span>docker<span class="hljs-regexp">/jenkins/</span>workspace<span class="hljs-regexp">/greentransportation.info/</span>ev-charging range-confidence<span class="hljs-regexp">/chap4-charging/</span><span class="hljs-number">4</span>-charging-levels.html.md <span class="hljs-regexp">/home/</span>docker<span class="hljs-regexp">/jenkins/</span>workspace<span class="hljs-regexp">/greentransportation.info/</span>out/ev-charging FIRST RENDER <span class="hljs-number">0.002</span> seconds
<span class="hljs-regexp">/home/</span>docker<span class="hljs-regexp">/jenkins/</span>workspace<span class="hljs-regexp">/greentransportation.info/</span>ev-charging range-confidence<span class="hljs-regexp">/chap4-charging/</span><span class="hljs-number">4</span>-charging-levels.html.md <span class="hljs-regexp">/home/</span>docker<span class="hljs-regexp">/jenkins/</span>workspace<span class="hljs-regexp">/greentransportation.info/</span>out/ev-charging FIRST MAHABHUTA <span class="hljs-number">0.036</span> seconds
<span class="hljs-regexp">/home/</span>docker<span class="hljs-regexp">/jenkins/</span>workspace<span class="hljs-regexp">/greentransportation.info/</span>ev-charging range-confidence<span class="hljs-regexp">/chap4-charging/</span><span class="hljs-number">4</span>-charging-levels.html.md <span class="hljs-regexp">/home/</span>docker<span class="hljs-regexp">/jenkins/</span>workspace<span class="hljs-regexp">/greentransportation.info/</span>out/ev-charging SECOND RENDER <span class="hljs-number">0.335</span> seconds
<span class="hljs-regexp">/home/</span>docker<span class="hljs-regexp">/jenkins/</span>workspace<span class="hljs-regexp">/greentransportation.info/</span>ev-charging range-confidence<span class="hljs-regexp">/chap4-charging/</span><span class="hljs-number">4</span>-charging-levels.html.md <span class="hljs-regexp">/home/</span>docker<span class="hljs-regexp">/jenkins/</span>workspace<span class="hljs-regexp">/greentransportation.info/</span>out/ev-charging RENDERED <span class="hljs-number">0.336</span> seconds
</code></pre>
<h2>Clean up <code>config.js</code> - Allow Plugin constructor to take options object</h2>
<p>This may seem like a small thing, but it has the potential to hugely clean up <code>config.js</code> files.</p>
<p>In the past configuring a Plugin meant a construct like this:</p>
<pre><code class="hljs language-js">config.use(<span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;akashacms-base&apos;</span>));

config.plugin(<span class="hljs-string">&quot;akashacms-base&quot;</span>).generateSitemap(config, <span class="hljs-literal">true</span>);

config.plugin(<span class="hljs-string">&quot;akashacms-external-links&quot;</span>)
    .setTargetBlank(config, <span class="hljs-literal">true</span>)
    .setShowFavicons(config, <span class="hljs-string">&quot;before&quot;</span>);
</code></pre>
<p>And then inside the Plugin, the configuration data is not stored in the Plugin instance but instead in the Configuration.  Like:</p>
<pre><code class="hljs language-js">config.pluginData(pluginName).linkRelTags.push(lrTag);
</code></pre>
<p>On reflection this seemed backwards.  The new API now supports this model instead:</p>
<pre><code class="hljs language-js">config.use(<span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;akashacms-dlassets&apos;</span>), {
        <span class="hljs-attr">cachedir</span>: path.join(__dirname, <span class="hljs-string">&apos;dlassets-cache&apos;</span>)
    });
</code></pre>
<p>That is the <code>use</code> method now takes an optional second argument containing an options object.  The options object is defined by the Plugin, and will be documented by the Plugin.</p>
<p>The second change is that the options data is stored in a Plugin field named <code>options</code>.  That means the Plugin implementation does not need to retrieve <code>config.pluginData</code> but can manipulate its options on its own.</p>
<h1>Changes in Mahabhuta</h1>
<h2>Support using a MahafuncArray in both AkashaRender and other 3rd party software</h2>
<p>The following API is suggested for modules that define MahafuncArray&apos;s.  This API is meant to support using the MahafuncArray not just in AkashaRender, but in other software.</p>
<pre><code class="hljs language-js"><span class="hljs-built_in">module</span>.exports.process = <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">text, metadata, options</span>) </span>{
    <span class="hljs-keyword">let</span> funcs = <span class="hljs-built_in">module</span>.exports.mahabhutaArray(options);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> mahabhuta.processAsync(text, metadata, funcs);
};

<span class="hljs-built_in">module</span>.exports.mahabhutaArray = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) </span>{
    <span class="hljs-keyword">let</span> ret = <span class="hljs-keyword">new</span> mahabhuta.MahafuncArray(pluginName, options);
    ret.addMahafunc(...);
    ... add other Mahafunc objects
    <span class="hljs-keyword">return</span> ret;
};
</code></pre>
<p>The MahafuncArray object can be initialized with an <code>options</code> object (see the next section).</p>
<p>The <code>process</code> function is designed to take HTML text, construct the MahafuncArray, process the HTML using that array, and then return the processed HTML.</p>
<h2>MahafuncArray options</h2>
<p>Like for Plugin&apos;s, the MahafuncArray object can be initialized with an options object.</p>
<p>Each Mahafunc receives a reference to the MahafuncArray it has been added to.</p>
<p>This gives us an organized method to configure the Mahafunc&apos;s in a MahafuncArray.  Presumably such Mahafunc&apos;s are related to each other, and therefore we can tailor their action through one options object.</p>
<p>Since this probably seems obtuse, let&apos;s walk through a concrete example.</p>
<p>In the <code>akashacms-external-links</code> plugin the <code>configure</code> method reads as follows:</p>
<pre><code class="hljs language-js">configure(config, options) {
    config.addAssetsDir(path.join(__dirname, <span class="hljs-string">&apos;assets&apos;</span>));
    <span class="hljs-keyword">this</span>[_plugin_options] = options;
    config.addMahabhuta(elp_funcs.mahabhutaArray(<span class="hljs-keyword">this</span>[_plugin_options]));
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
}
</code></pre>
<p>The new <code>options</code> argument coming from <code>config.js</code> is stored in the Plugin object.  The result is:</p>
<ul>
<li>In the <code>config</code> file we specify an options object.</li>
<li>That options object is passed into the Plugin for its use.</li>
<li>That options object is passed into the MahafuncArray for its use.</li>
<li>Each Mahafunc in the MahafuncArray has easy access to that options object.</li>
</ul>
<p>For example a Mahafunc can now do this:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">this</span>.array.options.preferNofollow
</code></pre>
<p>The options are now this easy to access.</p>
<p>In the past the Mahafunc had to jump through a hoop:</p>
<pre><code class="hljs language-js">metadata.config.pluginData(pluginName).linkRelTags
</code></pre>
<p>This meant we overloaded the <code>metadata</code> object to contain other data such as a reference to the <code>config</code> object.  That still didn&apos;t give us the Plugin object, and we had to look up the <code>pluginData</code> for the Plugin.</p>
<p>The new method is much cleaner.</p>

    <div class="btn-group blog-prev-next-wrapper" role="group" aria-label="Next/Previous">
    <a class="btn btn-outline-primary blog-prev-link" href="plugin-update-plan.html" role="button">
    &#xAB;&#xAB;&#xAB;&#xAB;&#xAB;&#xAB; With 0.7, the AkashaCMS plugins need to be updated to reflect new API&apos;s</a>
    <a class="btn btn-outline-primary blog-next-link" href="../03/mahabhuta-external-links.html" role="button">
    <span style="float: right">How to set rel=nofollow or affiliate tags in external links in a Node.js web application &#xBB;&#xBB;&#xBB;&#xBB;&#xBB;&#xBB;</span></a>
</div>
    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'akashacms'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the 
                    <img class="akashacms-external-links-favicon opengraph-no-promote" src="https://www.google.com/s2/favicons?domain=disqus.com" style="display: inline-block; padding-right: 2px;" alt="(disqus.com)">
                    <a href="https://disqus.com/?ref_noscript" rel="nofollow" target="_blank">comments powered by Disqus.</a></noscript>

                    <img class="akashacms-external-links-favicon opengraph-no-promote" src="https://www.google.com/s2/favicons?domain=disqus.com" style="display: inline-block; padding-right: 2px;" alt="(disqus.com)">
                    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow" target="_blank">comments powered by <span class="logo-disqus">Disqus</span></a>
  </article>
  <section id="right" class="col-sm-2">
    
    
<p>

                    <img class="akashacms-external-links-favicon opengraph-no-promote" src="https://www.google.com/s2/favicons?domain=twitter.com" style="display: inline-block; padding-right: 2px;" alt="(twitter.com)">
                    <a href="https://twitter.com/AkashaCMS" rel="me nofollow" class="twitter-follow-button" data-show-count="false" target="_blank">Follow<br>@AkashaCMS</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</p>

<p>
                    <img class="akashacms-external-links-favicon opengraph-no-promote" src="https://www.google.com/s2/favicons?domain=www.facebook.com" style="display: inline-block; padding-right: 2px;" alt="(www.facebook.com)">
                    <a href="https://www.facebook.com/Nodejs-Web-Development-116624021765933/" rel="me nofollow" target="_blank">Follow Node.js Web Development on Facebook</a></p>

    
<ul class="list-group">

    <li class="list-group-item">
        <a rel="nofollow noskim" href="https://www.amazon.com/gp/product/1785881507/ref=as_li_ss_il?ie=UTF8&amp;fpl=fresh&amp;pf_rd_m=ATVPDKIKX0DER&amp;pf_rd_s=&amp;pf_rd_r=6C1SVA4RRTWPTY7VN1Z2&amp;pf_rd_t=36701&amp;pf_rd_p=14bf09e4-93c8-43ff-8639-e7979e7d1787&amp;pf_rd_i=desktop&amp;linkCode=li2&amp;tag=davidherron-20&amp;linkId=1a83c9a47355206fbe8622bf9e90b086" target="_blank"><img border="0" src="https://ws-na.amazon-adsystem.com/widgets/q?_encoding=UTF8&amp;ASIN=1785881507&amp;Format=_SL250_&amp;ID=AsinImage&amp;MarketPlace=US&amp;ServiceVersion=20070822&amp;WS=1&amp;tag=techsparx-20" width="175"></a>
    </li>

    <li class="list-group-item">
        <a rel="nofollow noskim" href="https://www.amazon.com/Asynchronous-Node-js-JavaScript-Promises-Generators-ebook/dp/B01N2Z4SOR/ref=as_li_ss_tl?ie=UTF8&amp;qid=1498526267&amp;sr=8-1&amp;keywords=asynchronous+javascript+promises+generators&amp;linkCode=ll1&amp;tag=techsparx-20&amp;linkId=0b8a5dc44c97bf8eb8452dac15ae724b" target="_blank"><img border="0" src="https://techsparx.com/nodejs/img/es-2015-16-17-promises-generators-and-async-await-2-1000.jpg" width="175"></a>
    </li>

    <li class="list-group-item">
        <a rel="nofollow noskim" href="https://www.amazon.com/Creating-eBooks-Markdown-Source-Tools-ebook/dp/B00WTKDH72/ref=as_li_ss_tl?_encoding=UTF8&amp;psc=1&amp;refRID=4SGHASEAZJKJBV0G60R0&amp;linkCode=ll1&amp;tag=techsparx-20&amp;linkId=941071a7b25f067767f82a7b11c06968" target="_blank"><img border="0" src="https://techsparx.com/nodejs/img/create-ebook-cover.jpg" width="175"></a>
    </li>

</ul>
  </section>
</div>

<footer class="row" style="text-align: center; height: 100px;">


<div class="fb-like-box" data-href="http://www.facebook.com/Akashacms" data-width="125" data-height="250" data-show-faces="false" data-stream="false" data-header="true"></div>

</footer>
</div>

<script src="../../../vendor/jquery/jquery.min.js"></script><script src="../../../vendor/popper.js/umd/popper.min.js"></script><script src="../../../vendor/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-37003917-1']);
  _gaq.push(['_setDomainName', 'akashacms.com']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>



</body>
</html>
